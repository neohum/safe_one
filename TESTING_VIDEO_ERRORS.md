# 비공개/삭제 동영상 테스트 가이드

## 테스트 목적

YouTube 비공개 동영상, 삭제된 동영상, 지역 제한 동영상 등을 자동으로 감지하고 대체 영상으로 전환하는 기능을 테스트합니다.

## 테스트 환경 설정

### 1. 개발 서버 실행

```bash
cd frontend
npm run dev
```

브라우저에서 http://localhost:5173 접속

### 2. 개발자 콘솔 열기

- **Chrome/Edge**: F12 또는 Cmd+Option+I (Mac)
- **Firefox**: F12 또는 Cmd+Option+K (Mac)
- **Safari**: Cmd+Option+C (Mac)

## 테스트 방법

### 방법 1: 실제 비공개/삭제 동영상 찾기

1. **랜덤 영상 보기** 버튼을 여러 번 클릭
2. 재생되지 않는 영상 발견 시 콘솔 확인
3. 자동으로 대체 영상으로 전환되는지 확인

### 방법 2: 테스트 데이터 추가

`frontend/src/data/posts.ts` 파일에 테스트 데이터 추가:

```typescript
{
  id: 9999,
  key_words: '가전제품',  // 기존 키워드 사용 (대체 영상 찾기 위해)
  contents: '[테스트] 비공개 동영상',
  url: 'https://www.youtube.com/watch?v=INVALID_VIDEO_ID',
  youtube_id: 'INVALID_VIDEO_ID',
  channel_name: '테스트',
  play_time: 1
}
```

## 예상 동작

### 1. 콘솔 로그

정상 영상:
```
영상 확인 성공: 영상 제목
```

오류 영상:
```
영상 재생 불가 (401): 사용 후 전기코드 뽑고 정리하기
영상 오류 처리 (oEmbed API 오류): 사용 후 전기코드 뽑고 정리하기
영상 오류 발생: 사용 후 전기코드 뽑고 정리하기
```

### 2. 화면 표시

1. **경고 메시지 표시** (1초간)
   ```
   ⚠️ 영상을 불러올 수 없습니다. 다른 영상을 찾고 있습니다...
   ```

2. **대체 영상 자동 재생**
   - 같은 키워드의 다른 영상으로 전환
   - 새로운 제목과 영상 표시

### 3. 타이밍

- **0초**: 즉시 영상 확인 시작
- **3초**: 첫 번째 반복 확인
- **6초**: 두 번째 반복 확인
- **9초**: 세 번째 반복 확인
- **10초**: 최종 확인

비공개 동영상은 보통 **3초 이내**에 감지됩니다.

## HTTP 상태 코드

YouTube oEmbed API 응답:

- **200**: 정상 영상
- **401**: 비공개 동영상
- **404**: 삭제된 동영상 또는 존재하지 않는 동영상
- **403**: 지역 제한 또는 저작권 문제

## 테스트 체크리스트

### 기본 기능
- [ ] 정상 영상 재생 확인
- [ ] 비공개 동영상 감지 (3초 이내)
- [ ] 삭제된 동영상 감지 (즉시)
- [ ] 경고 메시지 표시
- [ ] 대체 영상 자동 재생

### 대체 영상 선택
- [ ] 같은 키워드의 **최신** 영상 우선 선택
- [ ] 각 영상의 재생 가능 여부 확인
- [ ] ID가 높은 순으로 정렬 (최신 데이터)
- [ ] 같은 키워드가 없으면 다른 최신 영상 선택
- [ ] 제외 목록에 오류 영상 추가
- [ ] 같은 오류 영상 반복 재생 방지

### 콘솔 로그
- [ ] 영상 확인 성공 로그
- [ ] 영상 재생 불가 로그 (HTTP 상태 코드 포함)
- [ ] 영상 오류 처리 로그 (오류 이유 포함)
- [ ] 영상 오류 발생 로그 (영상 제목 포함)

### Home 페이지
- [ ] 랜덤 영상 재생
- [ ] 오류 발생 시 대체 영상 자동 재생
- [ ] "다른 영상 보기" 버튼 정상 작동

### Select 페이지
- [ ] 영상 목록 표시
- [ ] 영상 선택 후 재생
- [ ] 오류 발생 시 대체 영상 자동 재생
- [ ] 대체 영상이 없으면 목록으로 돌아가기

## 알려진 제한사항

### 1. CORS 제한
YouTube oEmbed API는 CORS를 허용하므로 브라우저에서 직접 호출 가능합니다.

### 2. API 제한
YouTube oEmbed API는 무료이며 별도의 API 키가 필요하지 않습니다.

### 3. 감지 시간
- 비공개 동영상: 3초 이내
- 삭제된 동영상: 즉시
- 지역 제한 동영상: 3초 이내

### 4. iframe 제한
iframe 내부의 YouTube 플레이어 상태는 직접 접근할 수 없으므로, oEmbed API를 사용하여 간접적으로 확인합니다.

## 문제 해결

### 문제: 정상 영상도 오류로 감지됨

**원인**: 네트워크 지연 또는 YouTube API 응답 지연

**해결**:
1. 네트워크 연결 확인
2. 브라우저 캐시 삭제
3. 다른 브라우저에서 테스트

### 문제: 비공개 동영상이 감지되지 않음

**원인**: YouTube oEmbed API가 비공개 동영상을 정상으로 반환하는 경우

**해결**:
1. 콘솔 로그 확인
2. HTTP 상태 코드 확인
3. 다른 비공개 동영상으로 테스트

### 문제: 대체 영상이 선택되지 않음

**원인**: 같은 키워드의 영상이 모두 오류인 경우

**해결**:
1. 제외 목록 확인 (콘솔 로그)
2. 다른 키워드의 영상으로 테스트
3. 제외 목록 초기화 (페이지 새로고침)

## 콘솔 로그 예시

### 정상 영상
```
영상 확인 성공: 사용 후 전기코드 뽑고 정리하기
```

### 오류 영상 및 대체 영상 선택
```
영상 재생 불가 (401): 사용 후 전기코드 뽑고 정리하기
영상 오류 처리 (oEmbed API 오류): 사용 후 전기코드 뽑고 정리하기
영상 오류 발생: 사용 후 전기코드 뽑고 정리하기
대체 영상 검색 시작: 사용 후 전기코드 뽑고 정리하기 (키워드: 가전제품)
같은 키워드의 영상 5개 발견
✓ 재생 가능: 전기 플러그 안전하게 사용하기
✗ 재생 불가: 전기 콘센트 주의사항
✓ 재생 가능: 전기 안전 수칙
✅ 선택된 대체 영상: 전기 플러그 안전하게 사용하기 (ID: 150)
```

## 향후 개선 사항

### 1. 오류 로깅
- 오류 발생한 영상 정보를 localStorage에 저장
- 관리자 페이지에서 확인 가능

### 2. 사용자 피드백 개선
- 대체 영상으로 전환 시 토스트 메시지
- "이 영상이 재생되지 않아 비슷한 최신 영상을 찾았습니다"

### 3. 스마트 대체 영상 선택
- ✅ ID 기반 최신성 판단 (현재 구현됨)
- ✅ 재생 가능 여부 사전 확인 (현재 구현됨)
- 채널명도 고려 (향후)
- 재생시간 유사도 고려 (향후)
- 인기도 기반 선택 (향후)

## 참고 자료

- [YouTube oEmbed API](https://developers.google.com/youtube/v3/docs/videos)
- [VIDEO_ERROR_HANDLING.md](./VIDEO_ERROR_HANDLING.md)

